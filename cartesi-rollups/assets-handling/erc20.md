---
id: ERC20
title: Depositing ERC20 assets
tags: [learn, rollups, dapps, components]
---

In this guide, you will learn how to deposit ERC20 assets into a Cartesi DApp both locally and on a testnet. We will demonstrate this using the ERC20 DApp as an example. If you have a custom DApp, please refer to the [Assets Handling section](./assets-handling.md).


## Pre-requisites

1. Docker Environment
  - Docker version 20.10.14 with Docker Buildkit enabled.
  - We recommend Docker Desktop, as it enables Buildkit by default.
  - Alternatively, set the environment variable: `DOCKER_BUILDKIT=1`.
2. Cast
  - Download and install from [Foundry's Installation Guide](https://book.getfoundry.sh/getting-started/installation).

## Sending ERC20 to a DApp running locally

### Starting the DApp

1. Clone the rollups-examples repository

```shell
git clone https://github.com/cartesi/rollups-examples.git
```

2. Navigate to the DApp repository:

```shell
cd erc20
```

3. Build the application back-end on your localhost:

```shell
docker compose -f ../docker-compose.yml -f ./docker-compose.override.yml -f ../docker-compose-host.yml up
```

4. Start the application:

```python
cd erc20/
python3 -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt
ROLLUP_HTTP_SERVER_URL="http://127.0.0.1:5004" NETWORK="localhost" python3 erc20.py
```

### Obtaining the DApp settings

For asset deposits, you need:

* PRIVATE_KEY
* ERC20_ADDR
* ERC20_PORTAL
* RPC_URL
* DAPP_ADDRESS

On application start, a `deployments` directory is created. The `ERC20Portal.json` inside this directory contains the address of the ERC20 Portal. The `dapp.json` contains your DApp's address.

The ERC20_ADDR is a simple ERC20 token utilized by Cartesi DApps. Find its address in `common-contracts/deployments/SimpleERC20.json`.

### Building the frontend-console

1. Open a separate terminal window
2. From the rollups-examples base directory, navigate to the `frontend-console` one:
```shell
cd frontend-console
```
3. Build the frontend console application:
```shell
yarn
yarn build
```

### Depositing through the frontend-console

The frontend-console simplifies the deposit process by handling certain complexities on behalf of the user. Deposits to a DApp are channeled through the Portal, which operates as a contract. Given its nature, the Portal doesn't inherently have the authority to manage your assets. To address this, the frontend-console initially grants the Portal the necessary permissions to handle your assets, followed by executing the deposit (by invoking the deposit method of the Portal).

When using a Cartesi DApp that handles ERC20, it's crucial that the DApp is configured with the ERC20 token. You have the flexibility to either deploy your own ERC20 token (using tools like Remix), or alternatively, you can employ the `SimpleERC20.sol` found within the `common-contracts` directory of the `rollups-examples` folder.

1. Deposit ERC20 tokens by running:

```shell
yarn start erc20 deposit --amount XXX 
```

Replace `XXX` with the amount you need to deposit.

2. Verify the notices generated by your inputs, by running:

```shell
yarn start notice list
```

3. The payload of the notice will resemble the following:

```shell
"Deposit received from: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266; ERC-20: 0xa513e6e4b8f2a923d98304ec87f64353c4d5c853; Amount: 100"
```

### Sending a request through cast

1. Declare the variables:

```shell
export PRIVATE_KEY="0x...0"
export ERC20_ADDR="0x...0"
export ERC20_PORTAL="0x...0"
export RPC_URL="http://localhost:8545"
export DAPP_ADDRESS="0x...0"
```

Replace `"0x...0"` with their corresponding actual values, as detailed in the preceding sections.

2. Grant the Portal permission to handle your assets:

```shell
docker run --rm --net="host" ghcr.io/foundry-rs/foundry "cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $ERC20_ADDR \"approve(address,uint256)\" $ERC20_PORTAL 100"
```


3. Call the deposit method of the portal:

```shell
docker run --rm --net="host" ghcr.io/foundry-rs/foundry "cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $ERC20_PORTAL \"depositERC20Tokens(address,address,uint256,bytes)\" $ERC20_ADDR $DAPP_ADDRESS 100 0x"
```

## Sending ERC20 to a DApp running on a testnet

### Starting the DApp

1. Clone the rollups-examples repository

```shell
git clone https://github.com/cartesi/rollups-examples.git
```

2. Navigate to the DApp repository:

```shell
cd erc20
```

3. Build the application back-end, replacing `<network>` with the name of your target network:

```shell
docker buildx bake machine --load --set *.args.NETWORK=<network>
```

:::note
If you are running `zsh`, Tto avoid the zsh error when using a glob pattern, enclose the argument in quotes like `docker buildx bake machine --load --set "*.args.NETWORK=sepolia"`.
:::

4. Deploy the back-end to a corresponding Rollups smart contract by running:


```python
export MNEMONIC=<user sequence of twelve words>
export RPC_URL=<https://your.rpc.gateway>
```

The `<user sequence of twelve words>` sets your wallet's mnemonic, a sequence of twelve words used to generate private keys.

The `<https://your.rpc.gateway>` sets the URL for your preferred RPC gateway, a connection point for interacting with the Ethereum network. 

5. Start the local Cartesi Node, replacing `<network>` with the name of your preferred network:

```shell
DAPP_NAME=<example> docker compose --env-file ../env.<network> -f ../docker-compose-testnet.yml -f ./docker-compose.override.yml up
```

### Obtaining the DApp settings

For asset deposits, you need:

* PRIVATE_KEY
* ERC20_ADDR
* ERC20_PORTAL
* RPC_URL
* DAPP_ADDRESS

On application start, a `deployments` directory is created. The `ERC20Portal.json` inside this directory contains the address of the ERC20 Portal. The `dapp.json` contains your DApp's address.

The ERC20_ADDR is a simple ERC20 token utilized by Cartesi DApps. Find its address in [rollups-contracts](https://github.com/cartesi/rollups-contracts/tree/main/onchain%2Frollups%2Fdeployments).

### Building the frontend-console

1. Open a separate terminal window
2. From the rollups-examples base directory, navigate to the `frontend-console` one:
```shell
cd frontend-console
```
3. Build the frontend console application:
```shell
yarn
yarn build
```

### Depositing through the frontend-console

The frontend-console simplifies the deposit process by handling certain complexities on behalf of the user. Deposits to a DApp are channeled through the Portal, which operates as a contract. Given its nature, the Portal doesn't inherently have the authority to manage your assets. To address this, the frontend-console initially grants the Portal the necessary permissions to handle your assets, followed by executing the deposit (by invoking the deposit method of the Portal).

When using a Cartesi DApp that handles ERC20, it's crucial that the DApp is configured with the ERC20 token. You have the flexibility to either deploy your own ERC20 token (using tools like Remix), or alternatively, you can employ the `SimpleERC20.sol` found within the `common-contracts` directory of the `rollups-examples` folder.



1. Deposit ERC20 tokens by running:

```shell
yarn start erc20 deposit --amount XXX 
```

Replace `XXX` with the amount you need to deposit.

2. Verify the notices generated by your inputs, by running:

```shell
yarn start notice list
```

3. The payload of the notice will resemble the following:

```shell
"Deposit received from: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266; ERC-20: 0xa513e6e4b8f2a923d98304ec87f64353c4d5c853; Amount: 100"
```

### Sending a request through cast

1. Declare the variables:

```shell
export PRIVATE_KEY="0x...0"
export ERC20_ADDR="0x...0"
export ERC20_PORTAL="0x...0"
export RPC_URL="<https://your.rpc.gateway>"
export DAPP_ADDRESS="0x...0"
```

Replace `"0x...0"`and `<https://your.rpc.gateway>` with their corresponding actual values, as detailed in the preceding sections.

2. Grant the Portal permission to handle your assets:

```shell
docker run --rm --net="host" ghcr.io/foundry-rs/foundry "cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $ERC20_ADDR \"approve(address,uint256)\" $ERC20_PORTAL 100"
```


3. Call the deposit method of the portal:

```shell
docker run --rm --net="host" ghcr.io/foundry-rs/foundry "cast send --private-key $PRIVATE_KEY --rpc-url $RPC_URL $ERC20_PORTAL \"depositERC20Tokens(address,address,uint256,bytes)\" $ERC20_ADDR $DAPP_ADDRESS 100 0x"
```
